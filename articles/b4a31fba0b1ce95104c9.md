---
title: "Deno ã‚’ä½¿ã£ã¦ Vim/Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ã by denops.vim"
emoji: "ğŸœ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vim", "neovim", "deno", "denops"]
published: true
---

ã©ã†ã‚‚ã€æœ€è¿‘ Rust ã¨ Deno ã«ãƒãƒã£ã¦ã‚‹ã‚ã‚Šã™ãˆã§ã™ã€‚

ä»Šæ—¥ã¯ [vim-jp][] ã§é–‹ç™ºã‚’é–‹å§‹ã—ãŸ [denops.vim][] ã®ç´¹ä»‹ã¨ denops.vim ã‚’åˆ©ç”¨ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚

[vim-jp]: https://vim-jp.org/
[denops.vim]: https://github.com/vim-denops/denops.vim

# denops.vim ã¨ã¯

denops.vim ã¯ JavaScript/TypeScript ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã‚ã‚‹ [Deno][] ã‚’åˆ©ç”¨ã—ã¦ Vim/Neovim åŒæ–¹ã§å‹•ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã‚‹ãŸã‚ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚

- Vim / Neovim ã§åŒä¸€ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨å¯èƒ½
- Vim ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½
- Vim script ã¨æ¯”è¼ƒã—ã¦ã‚¨ãƒ³ã‚¸ãƒ³ãŒçˆ†é€Ÿãªã®ã§ã‚´ãƒªæŠ¼ã—ãŒå¯èƒ½
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¾å­˜ç®¡ç†ãŒä¸è¦
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒåˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å‹•ä½œã™ã‚‹ãŸã‚ Vim ãŒå›ºã¾ã‚Šã«ãã„
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ¯ã«ã‚¹ãƒ¬ãƒƒãƒ‰ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ç›¸äº’å¹²æ¸‰ãŒèµ·ã“ã‚Šã«ãã„
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ¯ã«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šå¯èƒ½ãªãŸã‚å®‰å…¨æ€§ãŒé«˜ã„ï¼ˆæœªå®Ÿè£…ï¼‰

[deno]: https://deno.land/

# ç”¨èªé›†

| ç”¨èª              | æ„å‘³                                                                    |
| ----------------- | ----------------------------------------------------------------------- |
| Denops            | Deno ã‚’ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨ã—ã¦åˆ©ç”¨ã—ãŸ Vim/Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§ã™ |
| Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ | Denops ã‚’ç”¨ã„ã¦æ›¸ã‹ã‚ŒãŸ Vim/Neovim åŒæ–¹ã§å‹•ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¡¨ã—ã¾ã™   |

# Denops ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ Denops è‡ªä½“ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã ã‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## 0. Deno ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://deno.land/#installation ã‚’å‚è€ƒã« Deno ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
Getting Started ã®ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦çµæœãŒå¸°ã£ã¦ãã‚Œã°æˆåŠŸã§ã™ã€‚

```sh
deno run https://deno.land/std/examples/welcome.ts
```

ãªãŠã€æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚Œã°ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§æœ€æ–°ç‰ˆã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚

```sh
deno upgrade
```

## 1. Denops ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

é€šå¸¸ã® Vim ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ [denops.vim][] ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
ä¾‹ãˆã° [vim-plug][] ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã¯ `.vimrc` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã—ã¦ã‹ã‚‰ `:PlugInstall` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```vim
Plug 'vim-denops/denops.vim'
```

[vim-plug]: https://github.com/junegunn/vim-plug

:::message
Denops ã¯ `VinEnter` ã§å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ [dein.vim][] ç­‰ã®é…æ»ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã¯éæ¨å¥¨ã§ã™ã€‚
:::

[dein.vim]: https://github.com/Shougo/dein.vim

# é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

ã“ã“ã‹ã‚‰å°ã•ãª Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿéš›ã«ä½œã£ã¦ã¿ã¾ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã¯ `helloworld` ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒ›ãƒ¼ãƒ ç›´ä¸‹ã® `dps-helloworld` ã¨ä»®å®šã—ã¾ã™ã€‚

## 0. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºå‰æº–å‚™

Vim ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ Vim ã® `runtimepath` ã«å­˜åœ¨ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚ Vim ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ãŸã‚ã€åŒæ§˜ã« `runtimepath` ã«å­˜åœ¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ä»¥ä¸‹ã‚’ `.vimrc` ã«è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚

```vim
set runtimepath^=~/dps-helloworld
```

æ¬¡ã« Deno ã®èµ·å‹•æ™‚å‹ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã€ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’ `.vimrc` ã«è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚

```vim
let g:denops#server#service#deno_args = [
     \ '-q',
     \ '--unstable',
     \ '-A',
     \]
```

:::message
å‹ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹ãªçŠ¶æ…‹ã§ã¯ã€Deno ã®èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚é–‹ç™ºãŒè½ã¡ç€ã„ãŸã‚‰ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã®æ˜ç¤ºæŒ‡å®šã‚’æ¶ˆã—ã¦ãã ã•ã„ã€‚
:::

## 1. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ

ã¾ãšä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ `~/dps-helloworld` ã‚’ä½œæˆã—ã€ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã—ã¾ã™ã€‚
Windows ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹æ–¹ã¯ã€é©æ™‚ã‚³ãƒãƒ³ãƒ‰ã‚’èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

```sh
mkdir ~/dps-helloworld
cd ~/dps-helloworld
```

æ¬¡ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¿…è¦æœ€ä½é™ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
mkdir -p denops/helloworld
touch denops/helloworld/app.ts
```

æœ€çµ‚çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«ãªã£ã¦ã„ã‚Œã° OK ã§ã™ã€‚

```
dps-helloworld
â””â”€â”€ denops
    â””â”€â”€ helloworld
        â””â”€â”€ app.ts
```

Denops ã¯è‡ªå‹•çš„ã« `runtimepath` å†…ã® `denops/*/app.ts` ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
ãã®ãŸã‚ä¸Šè¨˜ã®ã‚ˆã†ãªæ§‹é€ ãŒ Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åŸºæœ¬å‹ã¨ãªã‚Šã¾ã™ã€‚

:::message
[denops.vim][] v0.11.0 ä»¥å‰ã¯ `app.ts` ã®ä»£ã‚ã‚Šã« `mod.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã—ãŸ
:::

## 2. éª¨çµ„ã¿ã®è¿½åŠ 

Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ [denops-std][] ã¨ã„ã† Deno ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® [`main()`](https://doc.deno.land/https/deno.land/x/denops_std/mod.ts#main) é–¢æ•°ã§åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ãã®ãŸã‚ `app.ts` ã®å†…å®¹ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";

main(async ({ vim }) => {
  // ã“ã“ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åˆæœŸåŒ–å‡¦ç†ã‚’è¨˜è¼‰ã™ã‚‹
  console.log("Hello Denops!");
});
```

:::message
[denops-std][] v0.7 ä»¥å‰ã¯ [`start()`](https://doc.deno.land/https/deno.land/x/denops_std@v0.7/mod.ts#start) é–¢æ•°ã«ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«åˆæœŸåŒ–ã—ã¦ã„ã¾ã—ãŸã€‚

```ts:app.ts
import { start } from "https://deno.land/x/denops_std@v0.7/mod.ts";

start(async (vim) => {
  // ã“ã“ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åˆæœŸåŒ–å‡¦ç†ã‚’è¨˜è¼‰ã™ã‚‹
  console.log("Hello Denops!");
});
```
:::

ã“ã®çŠ¶æ…‹ã§ä¸€åº¦ Vim ã‚’å†èµ·å‹•ã™ã‚‹ã¨èµ·å‹•æ™‚ã« `[denops] Hello Denops!` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/y8fyu6tap3tapjbxtltni6jynq8y)

[denops-std]: https://deno.land/x/denops_std

## 3. API ã®è¿½åŠ 

Denops ã§ã¯å„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ API ã‚’é–¢æ•°ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚ã¾ãšã€ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã‚’è¿”å´ã™ã‚‹ `echo()` é–¢æ•°ã‚’ API ã¨ã—ã¦ç™»éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`app.ts` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãç›´ã—ã¦ãã ã•ã„ã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";

main(async ({ vim }) => {
  vim.register({
    async echo(text: unknown): Promise<unknown> {
      if (typeof text !== "string") {
        throw new Error(
          `'text' attribute of 'echo' in ${vim.name} must be string`,
        );
      }
      return await Promise.resolve(text);
    },
  });
});
```

:::message
å¼•æ•°ãŒå…¨ã¦ `unknown` å‹ã§æˆ»ã‚Šå€¤ãŒ `Promise<unknown>` ã‚‚ã—ãã¯ `Promise<void>` ãªé–¢æ•°ã®ã¿ API ã¨ã—ã¦ç™»éŒ²å¯èƒ½ã§ã™ã€‚
:::

ã“ã‚Œã§ `echo` ã¨ã„ã† API ãŒ `helloworld` ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚ã“ã® API ã‚’å‘¼ã³å‡ºã™ã«ã¯ `denops#request({plugin}, {func}, {args})` ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚Vim ã‚’å†èµ·å‹•å¾Œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€‚

```vim
:echo denops#request('helloworld', 'echo', ["Hello Denops!"])
```

ã“ã‚Œã«ã‚ˆã‚Š `Hello Denops!` ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2fyw9gsjs0mhxa132q2dkrz2yle3)

ãªãŠ `denops#request('helloworld', 'echo', [123])` ã®ã‚ˆã†ã«ã€æ–‡å­—åˆ—ä»¥å¤–ã‚’ä¸ãˆã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã‚’åãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ykf75d9whbfjjntdk93jxcfmilsc)

## 4. Vim æ©Ÿèƒ½ã®å‘¼ã³å‡ºã—

Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰ Vim ã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ã«ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«æ¸¡ã•ã‚Œã‚‹ `vim` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
å…ˆã»ã©ã® `echo` API ã‚’ Vim ã®ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦ç™»éŒ²ã—ã¦ã¿ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã« `app.ts` ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";

main(async ({ vim }) => {
  vim.register({
    async echo(text: unknown): Promise<unknown> {
      if (typeof text !== "string") {
        throw new Error(
          `'text' attribute of 'echo' in ${vim.name} must be string`,
        );
      }
      return await Promise.resolve(text);
    },
  });

  await vim.execute(`
    command! -nargs=1 HelloWorldEcho echomsg denops#request('${vim.name}', 'echo', [<q-args>])
  `)
});
```

`vim.execute()` ã¯æ¸¡ã•ã‚ŒãŸè¤‡æ•°è¡Œæ–‡å­—åˆ—ã‚’ Vim script ã¨ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚ã¾ãŸ `vim.name` ã¯å®Ÿè¡Œä¸­ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã‚’è¡¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š `HelloWorldEcho` ã‚³ãƒãƒ³ãƒ‰ãŒç™»éŒ²ã•ã‚Œã‚‹ã®ã§ Vim ã‚’å†èµ·å‹•å¾Œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```vim
:HelloWorldEcho Hello Vim!
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ã‚ˆã†ã« `Hello Vim!` ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/zcf4whdc44sa9k5a9s9gwk7gykyy)

ãªãŠ `vim` ã®è©³ç´° API ã¯ https://doc.deno.land/https/deno.land/x/denops_std/mod.ts#Vim ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## 5. å®Ÿç”¨çš„ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é–‹ç™º

ã“ã“ã¾ã§ã§ã€åŸºæœ¬çš„ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œã‚Šæ–¹ã¯èª¬æ˜ã—ãŸã®ã§ã€æ¬¡ã¯å®Ÿç”¨çš„ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

çªç„¶ã§ã™ãŒã€çš†æ§˜ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã—ã¦ã„ã‚‹ã¨ãã«çªç„¶è¿·è·¯ã‚’è§£ããŸããªã£ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
åƒ•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãŸã ã€ä¸–ã®ä¸­ã«ã¯è¿·è·¯ãŒå¥½ãã§å¥½ãã§ãŸã¾ã‚‰ãªã„äººã‚‚ã„ã‚‹ã¯ãšãªã®ã§ Vim ã‹ã‚‰ã„ã¤ã§ã‚‚è¿·è·¯ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤ºã§ãã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

è¿·è·¯ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‹ã‚‰è‡ªä½œã—ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ã›ã£ã‹ã Deno ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®è¿·è·¯ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ [maze_generator](https://deno.land/x/maze_generator@v0.4.0) ã‚’ä½¿ã„ã¾ã™ã€‚
ã¾ãš `HelloWorldEcho` ã‚³ãƒãƒ³ãƒ‰ã¨åŒæ§˜ã«ã—ã¦ `Maze` ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã—ã€å†…éƒ¨ã§ã¯è¿·è·¯ã‚’ç”Ÿæˆã—ã¦ `console.log()` ã§å‡ºåŠ›ã—ã¾ã™ã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";
import { Maze } from "https://deno.land/x/maze_generator@v0.4.0/mod.js";

main(async ({ vim }) => {
  vim.register({
    async maze(): Promise<void> {
      const maze = new Maze({}).generate();
      const content = maze.getString();
      console.log(content);
    },
  });

  vim.execute(`
    command! Maze call denops#request('${vim.name}', 'maze', [])
  `);
});
```

Vim ã‚’å†èµ·å‹•ã—ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‡ºåŠ›ã‚’ç¢ºèªã™ã‚‹ã¨è¿·è·¯ãŒç”Ÿæˆã§ãã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```vim
:Maze
:mes
```

![](https://storage.googleapis.com/zenn-user-upload/dv98sl6ml57ppy0e4r50nol0gry6)

ã“ã‚Œã§å®Œæˆã§ã‚‚ã„ã„ã®ã§ã™ãŒã€å°‘ã—å‘³æ°—ãŒãªã„ã®ã§ãƒãƒƒãƒ•ã‚¡ã«å‡ºåŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";
import { Maze } from "https://deno.land/x/maze_generator@v0.4.0/mod.js";

main(async ({ vim }) => {
  vim.register({
    async maze(): Promise<void> {
      const maze = new Maze({}).generate();
      const content = maze.getString();
      await vim.cmd("enew");
      await vim.call("setline", 1, content.split(/\n/));
    },
  });

  vim.execute(`
    command! Maze call denops#request('${vim.name}', 'maze', [])
  `);
});
```

ä¸Šè¨˜ã§ã¯ `vim.cmd()` ã§ Vim ã® `enew` ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã—æ–°è¦ãƒãƒƒãƒ•ã‚¡ã‚’ç¾åœ¨ã® Window ã§é–‹ã„ãŸå¾Œ `vim.call()` ã§ `setline()` é–¢æ•°ã‚’å‘¼ã¶ã“ã¨ã§ãƒãƒƒãƒ•ã‚¡ã«è¿·è·¯ã‚’æ›¸ãè¾¼ã‚“ã§ã„ã¾ã™ã€‚
ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ch1xyqz7i3k06c9bt33xokjee1pp)

è‰¯ã„æ„Ÿã˜ã§ã™ã­ã€‚
ã“ã‚Œã§çµ‚ã‚ã‚Šã§ã‚‚ã„ã„ã§ã™ãŒã€ã›ã£ã‹ããªã®ã§ `enew` ä»¥å¤–ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å¤–éƒ¨ã‹ã‚‰ä¸ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã‚Šã€ç¾åœ¨ã®è¡¨ç¤ºé ˜åŸŸã‹ã‚‰è¿·è·¯ã‚’ç”Ÿæˆã—ãŸã‚Šãªã©ã„ã‚ã„ã‚æ”¹è‰¯ã‚’åŠ ãˆã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

```ts:app.ts
import { main } from "https://deno.land/x/denops_std@v0.8/mod.ts";
import { Maze } from "https://deno.land/x/maze_generator@v0.4.0/mod.js";

main(async ({ vim }) => {
  vim.register({
    async maze(opener: unknown): Promise<void> {
      if (typeof opener !== "string") {
        throw new Error(`'opener' must be a string`);
      }
      const [xSize, ySize] = (await vim.eval("[&columns, &lines]")) as [
        number,
        number
      ];
      const maze = new Maze({
        xSize: xSize / 3,
        ySize: ySize / 3,
      }).generate();
      const content = maze.getString();
      await vim.cmd(opener || "new");
      await vim.call("setline", 1, content.split(/\r?\n/g));
      await vim.execute(`
        setlocal bufhidden=wipe buftype=nofile
        setlocal nobackup noswapfile
        setlocal nomodified nomodifiable
      `);
    },
  });

  vim.execute(`
    command! -nargs=? -bar Maze call denops#request('${vim.name}', 'maze', [<q-args>])
  `);
});
```

ã¡ã‚ƒã‚“ã¨å°ã•ãªè¿·è·¯ãŒã§ãã¦ã¾ã™ã­ã€‚

![](https://storage.googleapis.com/zenn-user-upload/nkd2tk0nwcwn0ww60ncbed4n3lwc)

## ãŠã‚ã‚Šã«

ã©ã†ã§ã—ã‚‡ã†ï¼ŸDenops ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã‹ãªã‚Šç°¡å˜ã« Vim/Neovim ã§å‹•ããƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½œã‚Œã‚‹ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿ
ã¾ã ã¾ã é–‹ç™ºä¸­ã§ã™ãŒ Vim/Neovim åŒæ–¹ã§åŠ¹ç‡çš„ã«å‹•ããƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ãŒé«˜ã„ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ã‚ˆã‘ã‚Œã°ã€ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã« Denops ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ã¦ã¿ã¦ãã ã•ã„ã€‚

- [denops-std API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://doc.deno.land/https/deno.land/x/denops_std/mod.ts)
- [denops ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](https://github.com/vim-denops/denops-helloworld.vim)
- [denops é–‹ç™ºãƒãƒ£ãƒãƒ« (vim-jp Slack)](https://vim-jp.slack.com/archives/C01N4L5362D)

çš†æ§˜ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ ğŸ™‡

# ãƒã‚¨ãƒ ï¼šé–‹ç™ºå‹•æ©Ÿ

ä»Š Vim/Neovim ã®é–¢ä¿‚ã¯å¤§ããªå¤‰è²ŒæœŸã«ã„ã¾ã™ã€‚

Vim å´ã¯ Vim script ã®æ¬ ç‚¹ã‚’è£œã£ãŸæ–°ã—ã„è¨€èªã§ã‚ã‚‹ Vim 9 script ã®é–‹ç™ºã‚’é€²ã‚ã¦ãŠã‚Š Neovim å´ã¯ Vim script ã‚’å®Œå…¨ã«æ¨ã¦ã¦ Lua ã«ç§»è¡Œã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã« Vim/Neovim ã®ä¹–é›¢ãŒå¤§ããåºƒãŒã£ã¦ãŠã‚Šã€åŒæ–¹ã§å‹•ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ãã®ãŒéå¸¸ã«é›£ã—ããªã£ã¦ãã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

ãã‚“ãªä¸­ [coc.nvim][] ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã« Node.js ã‚’æ¡ç”¨ã— Vim/Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿæ§‹ã® **å¤–** ã§ç‹¬è‡ªã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’å±•é–‹ã™ã‚‹ã“ã¨ã§ Vim/Neovim åŒæ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¦ã„ã¾ã™ã€‚

ã—ã‹ã— coc.nvim ãŒæ¡ç”¨ã—ã¦ã„ã‚‹ Node.js ã¯ä¾å­˜ç®¡ç†ãŒè¤‡é›‘ãªãŸã‚ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã ã£ãŸã‚Šã¨ã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ä½¿ã„å‹æ‰‹ãŒè‰¯ã„ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã®ãŸã‚ä¾å­˜ç®¡ç†ã‚’å†…åŒ…ã—ã€ãƒã‚¤ãƒŠãƒªä¸€ã¤ãŒã‚ã‚Œã°å‹•ä½œã™ã‚‹ Deno ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚Œã° Vim/Neovim åŒæ–¹ã§å‹•ä½œã—ã€é–‹ç™ºã‚‚ç°¡å˜ãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒã§ãã‚‹ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨æ€ã„é–‹ç™ºã«è¸ã¿åˆ‡ã‚Šã¾ã—ãŸã€‚

[coc.nvim]: https://github.com/neoclide/coc.nvim
